{% extends 'admin/admin.twig' %}

{% import 'macros/forms.twig' as forms %}

{% block content %}
	{% include 'admin/preferences/tabs.twig' with {'activeTab': activeTab} %}
	<form action="{{ form.getAction() }}" method="post">
		{{ csrf_token() }}
		{{ forms.element_checkbox(form.enabled) }}
		{{ forms.element_input(form.from_name) }}
		{{ forms.element_input(form.from_email) }}
		{{ forms.element_select(form.transport_type) }}
		<div id="email_pref_smtp" class="{{ form.transport_type.getValue() != "smtp" ? 'd-none' : ''}}">
			<fieldset>
				<legend>SMTP</legend>
                {{ forms.element_input(form.smtp_host) }}
                {{ forms.element_input(form.smtp_port) }}
			</fieldset>
		</div>
		<div class="form-group">
			<input type="submit" class="btn btn-primary hvr-grow" value="{{ trans('buttons', 'save') }}">
			<a href="#" class="btn btn-warning hvr-grow" id="testMail">Test mail</a>
			<a href="{{ path_for('admin_servers_list') }}" class="btn btn-secondary hvr-grow">{{ trans('buttons', 'cancel') }}</a>
		</div>
	</form>
{% endblock %}

{% block javascript %}
	{{ parent() }}
	<script>
		$(document).ready(function () {
			$('#testMail').on('click', function (e) {
				e.stopPropagation();
				e.preventDefault();

				$.get('{{ path_for('admin_preferences_email_test') }}')
					.done(function (data) {
						if (data.success) {
							alert('SUCCESS');
						} else {
							alert('Fail' + data.message);
						}
					})
					.catch(function () {
						alert('Fail with server error');
					});
			});

			$('#email_pref_transport').on('change', function () {
				if ($(this).val() === 'smtp') {
				    $('#email_pref_smtp').show();
				} else {
                    $('#email_pref_smtp').hide();
				}
            });
		});
	</script>
{% endblock %}
